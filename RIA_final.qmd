---
title: "RIA final project - Evolution of Japan's trade flows after signing the ASEAN+1 in 1977"
author: "Kateryna Hanina"
format: html
---

Countries (11): Brunei (BRN), Cambodia (KHM), Indonesia (IDN), Laos (LAO), Malaysia (MYS), Myanmar (MMR), Philippines (PHL), Singapore (SGP), Thailand (THA), Vietnam (VNM), Japan (JPN).

# General

```{r}
library(tidyverse)
library(fixest) # perform estimations with multiple fixed-effects
library(stargazer)
library(huxtable)
```

# Custom formulas

```{r}
# To get lagged values in function of CONSECUTIVE observations (here years)
tlag <- function(x, n = 1L, along_with, default = NA) { 
  if (!is.numeric(n) | (length(n)>1)) stop("n must be a numeric of length one")
  index <- match(along_with - n, along_with, incomparables = NA)
  out <- x[index]
  if (!is.na(default)) out[which(is.na(index))] <- default
  out
}
```

```{r}
# To get lead values in function of CONSECUTIVE observations (here years)
tlead <- function(x, n = 1L, along_with, default = NA) { 
  if (!is.numeric(n) | (length(n)>1)) stop("n must be a numeric of length one")
  index <- match(along_with + n, along_with, incomparables = NA)
  out <- x[index]
  if (!is.na(default)) out[which(is.na(index))] <- default
  out
}
```


# Data

```{r}
data_asean_raw <- read.csv("./Gravity_csv_V202211/Gravity_V202211.csv")
```

## General modifications

```{r}
#Select only countries and columns we need
#remove non-existing countries after they started existing in different form (+Singapore independence since 1965)
#remove tech variables
data_asean_selected <- data_asean_raw %>%
  select(c(year, country_id_o, country_id_d, iso3_o, iso3_d, country_exists_o, country_exists_d, dist, comlang_off, comlang_ethno, comcol, col45, comleg_pretrans, comleg_posttrans, comrelig, col_dep_end_conflict, gdp_o, gdp_d, gatt_o, gatt_d, wto_o, wto_d, rta_type, tradeflow_comtrade_d)) %>%
  filter(year >= 1965 & country_exists_o == 1 & country_exists_d == 1) %>%
  select(-c(country_id_o, country_id_d, country_exists_o, country_exists_d))
```

```{r}
#set rta_type and trade flows to 0 if NA
data_asean_selected <- data_asean_selected %>%
  mutate(rta_type = coalesce(rta_type, 0),
         tradeflow_comtrade_d = coalesce(tradeflow_comtrade_d, 0))
```

```{r}
#create new columns:
#general presence in either GATT or WTO by origin and destination
#general dummy for presence of any RTA for all countries
#dummy for presence in either GATT or WTO if both countries are members of it
data_asean_selected <- data_asean_selected %>%
  mutate(gatt_wto_o = case_when((gatt_o == 1 | wto_o == 1) ~ 1, TRUE ~ 0),
         gatt_wto_d = case_when((gatt_d == 1 | wto_d == 1) ~ 1, TRUE ~ 0),
         rta = if_else(rta_type == 0, 0, 1),
         .after = wto_d) %>%
  mutate(gatt_wto_both = if_else((gatt_wto_o == 1 & gatt_wto_d == 1), 1, 0))
```

## ASEAN specific modifications

```{r}
#create tech columns for 10 ASEAN member states by origin and destination
#and manually assign dummy 1 for ASEAN+1 agreement with Japan since 2008
data_asean_selected <- data_asean_selected %>%
  mutate(asean_ms_o = case_when(iso3_o %in% c("BRN", "KHM", "IDN", "LAO", "MYS", "MMR", "PHL", "SGP", "THA", "VNM") ~ 1, TRUE ~ 0),
         asean_ms_d = case_when(iso3_d %in% c("BRN", "KHM", "IDN", "LAO", "MYS", "MMR", "PHL", "SGP", "THA", "VNM") ~ 1, TRUE ~ 0),
         rta_asean_plus = case_when((year>=2008 & asean_ms_o==1 & iso3_d=="JPN") | (year>=2008 & iso3_o=="JPN" & asean_ms_d==1) ~ 1, TRUE ~ 0))
```

# 1. Traditional Gravity Estimates

## Create necessary data

```{r}
# Select necessary years with 3 year intervals
asean_selected_tradit <- data_asean_selected %>%
  filter(year %in% seq(1965, 2020, 3))
```

```{r}
# Construct symmetric pair id's for exporter and importer
asean_selected_tradit <- asean_selected_tradit %>%
  mutate(pair = paste(pmin(iso3_o,iso3_d),pmax(iso3_o,iso3_d),sep = "_")) %>%
  group_by(pair) %>%
  mutate(pair_id = cur_group_id())
```

```{r}
# Construct exporter output and importer expenditure
#(is it GDPs?? Do we need to calculate them or can use gdp_o and gdp_d?)
asean_selected_tradit <- asean_selected_tradit %>%
  group_by(iso3_o,year) %>%
  mutate(Y_it = sum(tradeflow_comtrade_d)) %>%
  group_by(iso3_d,year) %>%
  mutate(E_jt = sum(tradeflow_comtrade_d))
```

We have problems with zeroes here, we get -inf in logged columns. But should be fine if we specify in estimation that tradeflows\>0 for traditional estimates

```{r}
# calculate logs
asean_selected_tradit <- asean_selected_tradit %>%
  mutate(across(c(tradeflow_comtrade_d, Y_it, E_jt, dist, gdp_o, gdp_d), ~log(.x), .names="ln_{.col}"))
```

## 1.1 Naive gravity estimation

```{r}
# Estimation with feols, which allows for FE and clusters

# without controlling for WTO, GATT and RTAs and with calculated Y and E
fit_ols1 <- feols(ln_tradeflow_comtrade_d ~ ln_dist + ln_Y_it + ln_E_jt + comlang_off + comcol + col45 + comleg_pretrans + comleg_posttrans + comrelig,
                data = asean_selected_tradit %>%
                  filter(tradeflow_comtrade_d > 0 & iso3_o != iso3_d), 
                vcov = cluster ~ pair_id)
summary(fit_ols1)

# without controlling for WTO, GATT and RTAs and with true gdp_o and gdp_d
fit_ols2 <- feols(ln_tradeflow_comtrade_d ~ ln_dist + ln_gdp_o + ln_gdp_d + comlang_off + comcol + col45 + comleg_pretrans + comleg_posttrans + comrelig,
                data = asean_selected_tradit %>%
                  filter(tradeflow_comtrade_d > 0 & iso3_o != iso3_d), 
                vcov = cluster ~ pair_id)
summary(fit_ols2) 
#GAELLE: Prof uses Y and E for the naive gravity model, note the true gdp + agree with AdÃ¨le
#ADELE: with this code, I find better significant results with true GDP, also a better R squared, but it's not in adequation with its code so we need to know if we have the choice to use the one we want or not.
```

## 1.2. Proxy for MRT

```{r}
## Calculate remoteness indices - Should we use true GDP or proxies for remoteness indices?
asean_selected_tradit = asean_selected_tradit %>%
  filter(Y_it > 0 & E_jt >0) %>%
  group_by(year) %>%
  mutate(Y_t = sum(Y_it), E_t = sum(E_jt)) %>%
  group_by(iso3_o, year) %>%
  mutate(remoteness_exp = sum(dist /(E_jt / E_t))) %>%
  group_by(iso3_d, year) %>%
  mutate(remoteness_imp = sum(dist / (Y_it / Y_t))) %>%
  mutate(ln_remoteness_exp = log(remoteness_exp), 
         ln_remoteness_imp = log(remoteness_imp))
#Katya: I tried to add condition on Y and E >0 and then it estimated fine (but not sure we are allowed to deal with zeroes in Y and E in this way)
#Adele: I checked and I think we have 2 options here; set Y and E to 0, or to the mean; maybe I will try with the mean and see if the results are similar.

##Estimation
fit_remoteness = feols(ln_tradeflow_comtrade_d ~ ln_dist + comlang_off + comcol + col45 + comleg_pretrans + comleg_posttrans + comrelig + ln_Y_it + ln_E_jt + ln_remoteness_exp + ln_remoteness_imp,
                       data = asean_selected_tradit %>% filter(tradeflow_comtrade_d > 0 & iso3_o != iso3_d),
                       vcov = cluster ~ pair_id)
summary(fit_remoteness) 
#Katya: I removed variable for conflict, cause we loose too many observations, then with this estimation we have R^2 56%, almost the same as in naive model 
#Gaelle: sounds weird to deal with zeros but if it only works like this, then I think that it is correct
#Adele:checked and look good for me; same as for the previous one, if we cannot deal with 0 for this one, we can still set Y and E to the mean.
```

## 1.3. Fixed Effects

```{r}
## Create fixed effects 
asean_selected_tradit = asean_selected_tradit %>%
     unite("fe_exp_year",c(iso3_o,year),sep="_",remove=FALSE) %>%
     unite("fe_imp_year",c(iso3_d,year),sep="_",remove=FALSE) %>%
     relocate(c(fe_exp_year,fe_imp_year), .after = 5)#in order to make it clear in the table

## Estimation 
fit_fixedeffects = feols(ln_tradeflow_comtrade_d ~ ln_dist + comlang_off + comcol + col45 + comleg_pretrans + comleg_posttrans + comrelig + gatt_wto_both |
                           fe_exp_year + fe_imp_year,
                         data = asean_selected_tradit %>% filter(tradeflow_comtrade_d > 0 & iso3_o != iso3_d),
                         vcov = cluster ~ pair_id)
summary(fit_fixedeffects) 
# Why do we get this negative coefficient for comleg_posttrans? Especially because the one for comleg_pretrans is positive..
```

## 1.4. PPML with FE

```{r}
## PPML model
fit_poisson = fepois(tradeflow_comtrade_d ~ ln_dist + comlang_off + comcol + col45 + comleg_pretrans + comleg_posttrans + comrelig + gatt_wto_both |
                           fe_exp_year + fe_imp_year,
                     data = asean_selected_tradit %>% filter(iso3_o != iso3_d),
                     vcov = cluster ~ pair_id)
summary(fit_poisson)
```

## Overview
```{r}
table_tradit <- huxreg("(1.1) OLS with proxies" = fit_ols1,
                       "(1.2) OLS with real GDP" = fit_ols2,
                       "(2) OLS with MRT" = fit_remoteness,
                       "(3) OLS with FE" = fit_fixedeffects,
                       "(4) PPML with FE" = fit_poisson,
                       statistics = c("N"="nobs", "R^2"="r.squared", "pseudo R^2"="pseudo.r.squared")) %>%
  set_col_width(c(0.3,rep(0.9/5,5))) %>%
  set_align(everywhere,-1,"center") %>%
  set_top_border(1,everywhere,1) %>%
  set_tb_borders(33,everywhere,0) %>%
  set_caption("Traditional Gravity Estimates")
table_tradit
#preliminary table output - later to decide on proxies/real GDP and remove one of them, if we keed read GDPs then also redo all regressions here, then add notes in the table, maybe format differently etc
```



# 2. Estimates of RTAs (general RTA, not ASEAN specific)

## Create necessary data

```{r}
# Select necessary years with 3 year intervals
asean_selected_rta <- data_asean_selected %>%
  filter(year %in% seq(1965, 2020, 3))
```

```{r}
# Construct symmetric pair id's for exporter and importer
asean_selected_rta <- asean_selected_rta %>%
  mutate(pair = paste(pmin(iso3_o,iso3_d),pmax(iso3_o,iso3_d),sep = "_")) %>%
  group_by(pair) %>%
  mutate(pair_id = cur_group_id())
```

```{r}
# calculate logs
asean_selected_rta <- asean_selected_rta %>%
  mutate(across(c(tradeflow_comtrade_d, dist), ~log(.x), .names="ln_{.col}"))
```

```{r}
## Create fixed effects 
asean_selected_rta = asean_selected_rta %>%
     unite("fe_exp_year",c(iso3_o,year),sep="_",remove=FALSE) %>%
     unite("fe_imp_year",c(iso3_d,year),sep="_",remove=FALSE) %>%
     relocate(c(fe_exp_year,fe_imp_year), .after = 5)#in order to make it clear in the table
```

```{r}
## Specify country-specific intra-national trade dummies
asean_selected_rta = asean_selected_rta %>%
mutate(D_trade_ii = ifelse(iso3_o==iso3_d,iso3_o,"international"))
```

## 2.1. Traditional estimates of RTAs (OLS)

```{r}
## OLS estimation
rta_ols = feols(ln_tradeflow_comtrade_d ~ ln_dist + comlang_off + comcol + col45 + comleg_pretrans + comleg_posttrans + comrelig + rta + gatt_wto_both |
                           fe_exp_year + fe_imp_year,
data = asean_selected_rta %>%
filter(ln_tradeflow_comtrade_d > 0 & iso3_o != iso3_d),
vcov = cluster ~ pair_id)

summary(rta_ols)
```



## 2.2. Traditional estimates of RTAs (PPML)
```{r}
rta_poisson = fepois(tradeflow_comtrade_d ~ ln_dist + comlang_off + comcol + col45 + comleg_pretrans + comleg_posttrans + comrelig + rta + gatt_wto_both |
                           fe_exp_year + fe_imp_year,
data = asean_selected_rta %>%
filter(iso3_o != iso3_d),
vcov = cluster ~ pair_id)

summary(rta_poisson)
```

### we can also estimate regression where we split RTA in types after we select the preffered specification
```{r}
#see amount of observations by type of RTA
table(asean_selected_rta$rta_type)

rta_poisson_types = fepois(tradeflow_comtrade_d ~ ln_dist + comlang_off + comcol + col45 + comleg_pretrans + comleg_posttrans + comrelig + as.factor(rta_type) + gatt_wto_both |
                           fe_exp_year + fe_imp_year,
data = asean_selected_rta %>%
filter(iso3_o != iso3_d),
vcov = cluster ~ pair_id)

summary(rta_poisson_types)

# is it ok that some RTAs have negative effects? --- maybe we need to exclude combined types of RTA?
#type 3 (EIA) might be negative due to only 56 observations in the whole dataset, so it's not significant
#type 7 (PSA&EIA) might be negative due to less deep integration in Partial Scope Agreements (and it's also only 471 observations in total)
```



## 2.3. Allowing for trade diversion from domestic sales (includes FE for intra-trade)
```{r}
## PPML estimation
rta_poisson_intra = fepois(tradeflow_comtrade_d ~ ln_dist + comlang_off + comcol + col45 + comleg_pretrans + comleg_posttrans + comrelig + rta + gatt_wto_both |
                           fe_exp_year + fe_imp_year + D_trade_ii,
data = asean_selected_rta,
vcov = cluster ~ pair_id)

summary(rta_poisson_intra)
```



## 2.4. Addressing potential endogeneity of RTAs
```{r}
## PPML estimation
rta_endo = fepois(tradeflow_comtrade_d ~ rta + gatt_wto_both |
fe_exp_year + fe_imp_year + pair_id,
data = asean_selected_rta,
vcov = cluster ~ pair_id)

## Head of results
head(asean_selected_rta[-rta_endo$obs_selection$obsRemoved,
                        c("iso3_o","iso3_d","year","tradeflow_comtrade_d")] %>%
       arrange(iso3_o,iso3_d,year),3)

summary(rta_endo)
#rta coeff should be significant, why it's NOT???
```

## Overview
```{r}
table_rta <- huxreg("(1) OLS with RTA" = rta_ols,
                    "(2.1) PPML with RTA" = rta_poisson,
                    "(2.2) PPML with RTA types" = rta_poisson_types,
                    "(3) PPML with intra-trade" = rta_poisson_intra,
                    "(4) PPML with endogeneity" = rta_endo,
                    statistics = c("N"="nobs", "R^2"="r.squared", "pseudo R^2"="pseudo.r.squared")) %>%
  set_col_width(c(0.3,rep(0.9/5,5))) %>%
  set_align(everywhere,-1,"center") %>%
  set_top_border(1,everywhere,1) %>%
  set_tb_borders(33,everywhere,0) %>%
  set_caption("Estimating General Effects of All Regional Trade Agreements")
table_rta
```

# 3. Estimates of RTAs (ASEAN specific)

## Create necessary data

```{r}
#---create different columns for separating ASEAN dummy from general rta and rta_type -- needs to be set to 0 if manually created ASEAN dummy for Japan=1:

#adjust variables rta and rta_type by setting them to 0 if rta_asean_plus=1, so we don't duplicate when use both all RTA for RoW and specific Japan-ASEAN RTA in the regression
asean_selected_rta <- asean_selected_rta %>%
  mutate(rta_excl_asean_plus = if_else(rta_asean_plus==1, 0, as.numeric(rta)),#general counterfactual
         rta_type_excl_asean_plus = if_else(rta_asean_plus==1, 0, as.numeric(rta_type))) #specific counterfactual

#based on adjusted rta_type segregate agreements of Japan in different types of RTA if Japan is in origin or destination
asean_selected_rta <- asean_selected_rta %>%
  mutate(jpn_cu = if_else((rta_type_excl_asean_plus==1 & iso3_o=="JPN") | (rta_type_excl_asean_plus==1 & iso3_d=="JPN"), 1, 0),
         jpn_cu_eia = if_else((rta_type_excl_asean_plus==2 & iso3_o=="JPN") | (rta_type_excl_asean_plus==2 & iso3_d=="JPN"), 1, 0),
         jpn_eia = if_else((rta_type_excl_asean_plus==3 & iso3_o=="JPN") | (rta_type_excl_asean_plus==3 & iso3_d=="JPN"), 1, 0),
         jpn_fta = if_else((rta_type_excl_asean_plus==4 & iso3_o=="JPN") | (rta_type_excl_asean_plus==4 & iso3_d=="JPN"), 1, 0),
         jpn_fta_eia = if_else((rta_type_excl_asean_plus==5 & iso3_o=="JPN") | (rta_type_excl_asean_plus==5 & iso3_d=="JPN"), 1, 0),
         jpn_psa_eia = if_else((rta_type_excl_asean_plus==7 & iso3_o=="JPN") | (rta_type_excl_asean_plus==7 & iso3_d=="JPN"), 1, 0))


#again adjust rta_type by setting them to 0 if member of ANY type of agreement is Japan,
#if not, then keep adjusted rta_type from the 1st step. This way we will not duplicate them in the regression when use variables specifically for Japan and for RoW (namely, when we use in regression Japan-ASEAN, Japan in all types of RTAs with RoW, and all types of RTAs between other countries in RoW)
asean_selected_rta <- asean_selected_rta %>%
  mutate(rta_type_all_clean = if_else((jpn_cu==1) | (jpn_cu_eia==1) | (jpn_eia==1) | (jpn_fta==1) | (jpn_fta_eia==1) | (jpn_psa_eia==1), 0, as.numeric(rta_type_excl_asean_plus)))
```


## 3.1. Traditional estimates of RTAs (OLS)

```{r}
## OLS estimation
rta_ols_asean = feols(ln_tradeflow_comtrade_d ~ ln_dist + comlang_off + comcol + col45 + comleg_pretrans + comleg_posttrans + comrelig + gatt_wto_both + rta_excl_asean_plus + rta_asean_plus |
                           fe_exp_year + fe_imp_year,
data = asean_selected_rta %>%
filter(ln_tradeflow_comtrade_d > 0 & iso3_o != iso3_d),
vcov = cluster ~ pair_id)

summary(rta_ols_asean)
```

## 3.2. Traditional estimates of RTAs (PPML)
```{r}
rta_poisson_asean = fepois(tradeflow_comtrade_d ~ ln_dist + comlang_off + comcol + col45 + comleg_pretrans + comleg_posttrans + comrelig + gatt_wto_both + rta_excl_asean_plus + rta_asean_plus |
                           fe_exp_year + fe_imp_year,
data = asean_selected_rta %>%
filter(iso3_o != iso3_d),
vcov = cluster ~ pair_id)

summary(rta_poisson_asean)
```
### we can also estimate regression where we split RTA in types after we select the preffered specification
```{r}
#see amount of observations by type of RTA
table(asean_selected_rta$rta_type)

rta_poisson_types_asean = fepois(tradeflow_comtrade_d ~ ln_dist + comlang_off + comcol + col45 + comleg_pretrans + comleg_posttrans + comrelig + gatt_wto_both + as.factor(rta_type_excl_asean_plus) + rta_asean_plus |
                           fe_exp_year + fe_imp_year,
data = asean_selected_rta %>%
filter(iso3_o != iso3_d),
vcov = cluster ~ pair_id)

summary(rta_poisson_types_asean)

#type 3 (EIA) might be negative due to only 56 observations in the whole dataset, so it's not significant
#type 7 (PSA&EIA) might be negative due to less deep integration in Partial Scope Agreements (and it's also only 471 observations in total)
```

## 3.3. Allowing for trade diversion from domestic sales (includes FE for intra-trade)
```{r}
## PPML estimation
rta_poisson_intra_asean = fepois(tradeflow_comtrade_d ~ ln_dist + comlang_off + comcol + col45 + comleg_pretrans + comleg_posttrans + comrelig + gatt_wto_both + rta_excl_asean_plus + rta_asean_plus |
                           fe_exp_year + fe_imp_year + D_trade_ii,
data = asean_selected_rta,
vcov = cluster ~ pair_id)

summary(rta_poisson_intra_asean)
```

## 3.4. Addressing potential endogeneity of RTAs
```{r}
## PPML estimation
rta_endo_asean = fepois(tradeflow_comtrade_d ~ gatt_wto_both + rta_excl_asean_plus + rta_asean_plus |
fe_exp_year + fe_imp_year + pair_id,
data = asean_selected_rta,
vcov = cluster ~ pair_id)

summary(rta_endo_asean)
#rta coeff should be significant, why it's NOT???
```

## Overview
```{r}
table_rta_asean <- huxreg("(1) OLS with RTA" = rta_ols_asean,
                    "(2.1) PPML with RTA" = rta_poisson_asean,
                    "(2.2) PPML with RTA types" = rta_poisson_types_asean,
                    "(3) PPML with intra-trade" = rta_poisson_intra_asean,
                    "(4) PPML with endogeneity" = rta_endo_asean,
                    statistics = c("N"="nobs", "R^2"="r.squared", "pseudo R^2"="pseudo.r.squared")) %>%
  set_col_width(c(0.3,rep(0.9/5,5))) %>%
  set_align(everywhere,-1,"center") %>%
  set_top_border(1,everywhere,1) %>%
  set_tb_borders(33,everywhere,0) %>%
  set_caption("Estimating General Effects of Japan's ASEAN+1 Agreement compared to All Regional Trade Agreements")
table_rta_asean
```




# 4. RTA Robustness Checks (not ASEAN specific)

## 4.1. Testing for potential reverse causality between trade and RTAs
```{r}
## Identify future RTAs with custom function
asean_selected_rta = asean_selected_rta %>%
  group_by(iso3_o,iso3_d) %>%
  mutate(rta_lead3 = tlead(rta,n=3,along_with = year))
```

```{r}
## Estimation
rta_lead = fepois(tradeflow_comtrade_d ~  rta + rta_lead3 |
                    fe_exp_year + fe_imp_year + pair_id,
                  data = asean_selected_rta, 
                  vcov = cluster ~ pair_id)

summary(rta_lead)
#rta should be significant, but rta_lead3 NOT - this way we will correctly control for reverse causality
```


## 4.2. Allowing for potential non-linear and phasing-in effects

```{r}
## Identify past RTAs to see how stronger effects get over time
asean_selected_rta = asean_selected_rta %>%
  group_by(iso3_o, iso3_d) %>%
  mutate(rta_lag3 = tlag(rta,n=3,along_with = year),
         rta_lag6 = tlag(rta,n=6,along_with = year),
         rta_lag9 = tlag(rta,n=9,along_with = year))
```

```{r}
rta_lags = fepois(tradeflow_comtrade_d ~  rta + rta_lag3 + rta_lag6 + rta_lag9 |
                    fe_exp_year + fe_imp_year + pair_id,
                  data = asean_selected_rta, 
                  vcov = cluster ~ pair_id)

summary(rta_lags)
#all coeffs of rta should be significant
```




## 4.3. Addressing globalization effects




# 5. RTA Robustness Checks (ASEAN specific)

## 5.1. Testing for potential reverse causality between trade and RTAs
```{r}
## Identify future RTAs with custom function
asean_selected_rta = asean_selected_rta %>%
  group_by(iso3_o,iso3_d) %>%
  mutate(rta_excl_asean_plus_lead3 = tlead(rta_excl_asean_plus,n=3,along_with = year),
         rta_asean_plus_lead3 = tlead(rta_asean_plus, n=3, along_with = year))
```

```{r}
## Estimation
rta_lead_asean = fepois(tradeflow_comtrade_d ~  rta_excl_asean_plus + rta_excl_asean_plus_lead3 + rta_asean_plus + rta_asean_plus_lead3 |
                    fe_exp_year + fe_imp_year + pair_id,
                  data = asean_selected_rta, 
                  vcov = cluster ~ pair_id)

summary(rta_lead_asean)
#rta should be significant, but rta_lead3 NOT - this way we will correctly control for reverse causality
```





TRIALS (NOT MAIN CODE)

```{r}
class(data_asean_selected$rta_type)
table(data_asean_selected$rta)
```

```{r}
table(data_asean_selected$country_id_d, data_asean_selected$country_exists_d)
asean_selected_tradit %>% filter(wto_o == 1)
```

```{r}
sum(is.na(asean_selected_tradit$Y_it))
colSums(is.na(asean_selected_tradit))
```

# Descriptive statistics
Full Sample
```{r}
dim(data_asean_selected)[1] #number of observations
table(data_asean_selected$rta)[2] #number of observations for RTA

```

Sample with 3 year intervals
```{r}
dim(asean_selected_rta)[1] #number of observations
table(asean_selected_rta$rta)[2] #number of observations for RTA
```

